<ion-header></ion-header>

<ion-content>
  <div class="optionsSales">
    <ion-icon name="add-outline" (click)="addProduct()"></ion-icon>
    <ion-icon name="scan-outline" (click)="scan()"></ion-icon>
  </div>

  <div class="search">
      <ion-searchbar
        animated="true" 
        placeholder="Producto" 
        show-clear-button="focus" 
        [debounce]="1000" 
        (ionInput)="handleInputSearchProduct($event)"
      >
      </ion-searchbar>
      <!-- <ion-icon name="funnel-outline" (click)="openSalesFilterModal()"></ion-icon> -->
  </div>

  @if(!querySearchBar) {
    <div class="content_title">
      @if ((allProducts | products: true)?.hasCategories) {
        <h2 style="font-weight: 600;">Categorias</h2>
      }
    </div>
  }

  <ion-grid>
    <!-- CATEGORIAS -->
    @if(!querySearchBar) {
      <ion-row class="ca_box">
        @for(category of (allProducts | products: true)?.data | keyvalue; track $index) {
          <ion-col class="ca_item">
            <ion-card 
              class="ca-item_card"
              (click)="openCategory(getString(category.key), category.value)"
            >
              <div
                [ngClass]="[isTouch ? 'ca-item_bg_touch' : 'ca-item_bg', (getCurrentCategoryName() === category.key) ? checkCardClass() : '']"
              ></div>
              <ion-card-header>
                <ion-card-title [ngClass]="isTouch ? 'ca-item_title_touch' : 'ca-item_title'">{{ category.key }}</ion-card-title>
              </ion-card-header>
            </ion-card>
          </ion-col>
        }
      </ion-row>
    }

    <!-- PRODUCTOS QUE SE MUESTRAN CUANDO SE ENTRA A UNA CATEGORIA -->
    @if(currentCategory.inside) {
      <div class="content_title insideCategory">
        <ion-text style="font-weight: 600; font-size: 1.5rem;">{{ currentCategory.nameCategory }}</ion-text>  
        <ion-icon name="close-outline" (click)="backToCategoriesSeccion()" style="font-size: 2rem; cursor: pointer;"></ion-icon>
      </div>
    }

    <ion-row style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); grid-gap: 25px; justify-items: center; padding: 0 10px;">
      @for (product of currentCategory.data; track $index) {
        <ion-col style="display: flex; align-items: center; justify-content: center; padding: 0; margin: 0;">
          <app-product-card 
            [productName]="product.name" 
            [productImageURL]="product.image_url"
            style="width: 100%;"
          >
          </app-product-card>
        </ion-col>
      }
    </ion-row>

    <!-- PRODUCTOS SIN CATEGORIA -->
    @if(((allProducts | products: false)?.data).length > 0 && !querySearchBar) {
      <div style="margin: 1rem 0; color: var(--ion-color-primary);">
        <h2 style="font-weight: 600;">Productos sin categor√≠a</h2>
      </div>
    }

    @if (!querySearchBar) {
      <ion-row style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); grid-gap: 25px; justify-items: center; padding: 0 10px;">
        @for (product of (allProducts | products: false)?.data; track $index) {
          <ion-col style="display: flex; align-items: center; justify-content: center; padding: 0; margin: 0;"> 
            <app-product-card
              [productName]="product.name" 
              [productImageURL]="product.image_url"
              (click)="selectQuantityOfProduct(product)"
              style="width: 100%;"
            >
            </app-product-card>
          </ion-col>
        }
      </ion-row>
    }

    <!-- PRODUCTOS QUE SE MUESTRAN CUANDO SE BUSCA ALGUN PRODUCTO -->
    @if (querySearchBar) {
      <ion-row>
        @for (product of resultsSearchBar; track product) {
          <ion-col size="auto">
            <app-product-card [productName]="product.name" [productImageURL]="product.image_url"></app-product-card>
          </ion-col>
        }
      </ion-row>
    }
  </ion-grid>
</ion-content>
